direction: down

# Top-level vertical layout
grid-rows: 4
grid-columns: 1
grid-gap: 20

# Row 1: Title (Left aligned)
title-row: "" {
  style.fill: transparent
  style.stroke: transparent
  grid-rows: 1
  grid-columns: 1
  horizontal-gap: 0

  title: "BMAD METHOD V6.0.0-alpha.23" {
    style.fill: transparent
    style.stroke: transparent
    style.font-size: 48
    style.bold: true
    style.font-color: "#1a3a5c"
    label.near: top-left
  }
}

vars: {
  d2-config: {
    layout-engine: elk
  }
}

# Row 2: Legend Placeholder
legend-row: "" {
  style.fill: transparent
  style.stroke: transparent
  height: 250
  width: 1200
  grid-rows: 1
  grid-columns: 1
}

# Row 3: Lanes container
lanes: "" {
    grid-columns: 4
    style.stroke: transparent
    style.fill: transparent
    
    # Phase 1
    phase1-box: "PHASE 1: DISCOVERY" {
        class: phase1-box
        
        Activities: {
            style: {
                fill: "#fff"
                stroke: "#2d7d9a"
                stroke-dash: 3
            }
            /research
            /brainstorming
        }
        
        /create-product-brief: {
            label: "/create-product-brief\n@product-brief.md"
            class: n1
        }
        
        Activities -> /create-product-brief
    }

    # Phase 2
    phase2-box: "PHASE 2: PLANNING" {
        class: phase2-box
        
        /prd: {
            label: "/prd\n@PRD.md"
            class: n2
        }
        
        decision: "Has UI?" {
            class: decision
        }
        
        /create-ux-design: {
            label: "/create-ux-design\n@ux-design-specification.md\n@ux-color-themes.html\n@ux-design-directions.html"
             class: n2
        }

        /prd -> decision
        decision -> /create-ux-design: Yes
    }
    
    # Phase 3
    phase3-box: "PHASE 3: SOLUTIONING" {
         class: phase3-box
         
         /create-architecture: {
             label: "/create-architecture\n@architecture.md"
             class: n3
         }
         
         /create-epics-and-stories: {
             label: "/create-epics-and-stories\n@epics.md"
             class: n3
         }
         
         /check-implementation-readiness: {
             label: "/check-implementation-readiness\n@implementation-readiness-report.md"
             class: n3
         }
         
         /create-architecture -> /create-epics-and-stories
         /create-epics-and-stories -> /check-implementation-readiness
    }
    
    # Phase 4
    phase4-box: "PHASE 4: IMPLEMENTATION" {
        class: phase4-box
        # grid-rows removed to allow connection-based layout
        
        cycle: "" {
            style.fill: transparent
            style.stroke: transparent
            
            /sprint-planning: {
                 label: "/sprint-planning\n@sprint-status.yaml"
                 class: n4
            }
            
            /create-story: {
                 label: "/create-story\n@{epic}-{story}-*.md"
                 class: n4
            }
            
            /dev-story: {
                 class: n4
            }
            
            /code-review: {
                 class: n4
            }
            
            /retrospective: {
                 class: n4
            }
            
            /sprint-planning -> /create-story
            /create-story -> /dev-story
            /dev-story -> /code-review
            /code-review -> /dev-story: fixes
            /code-review -> /retrospective
            /retrospective -> /sprint-planning: next epic
        }
        
        correction_container: "" {
            style.fill: transparent
            style.stroke: transparent
            
            /correct-course: {
                 label: "/correct-course\n@sprint-change-proposal.md"
                 class: n4
            }
            
            remark: "(run when issues arise)" {
                shape: text
                style.font-size: 20
                style.font-color: "#1a684a"
            }
            
            /correct-course -> remark: {style.stroke: transparent}
        }
        
        cycle -> correction_container: {style.stroke: transparent}
    }

    # Connections between phases
    phase1-box./create-product-brief -> phase2-box./prd
    phase2-box.decision -> phase3-box./create-architecture: No
    phase2-box./create-ux-design -> phase3-box./create-architecture
    phase3-box./check-implementation-readiness -> phase4-box.cycle./sprint-planning

}

# Row 4: Footer
footer-row: "" {
  style.fill: transparent
  style.stroke: transparent
  footer: "DRAFTED: 2026-01-25 • REPOSITORY: github.com/bmad-code-org/BMAD-METHOD • LICENSE: MIT • UNCLASSIFIED • DISTRIBUTION: UNLIMITED • SUPERSEDES: ALL PREVIOUS EDITIONS" {
    style.fill: transparent
    style.stroke: transparent
    style.font-size: 21
    style.font-color: "#555"
    style.italic: true
    label.near: bottom-left
  }
}

classes: {
  phase1-box: {
    style: {
      fill: "#e8f4f8"
      stroke: "#2d7d9a"
      stroke-width: 3
      border-radius: 12
      font-size: 27
      bold: true
      font-color: "#1a5568"
    }
  }
  phase2-box: {
    style: {
      fill: "#f0e8f8"
      stroke: "#7d2d9a"
      stroke-width: 3
      border-radius: 12
      font-size: 27
      bold: true
      font-color: "#551a68"
    }
  }
  phase3-box: {
    style: {
      fill: "#f8f0e8"
      stroke: "#9a7d2d"
      stroke-width: 3
      border-radius: 12
      font-size: 27
      bold: true
      font-color: "#684a1a"
    }
  }
  phase4-box: {
    style: {
      fill: "#e8f8f0"
      stroke: "#2d9a7d"
      stroke-width: 3
      border-radius: 12
      font-size: 27
      bold: true
      font-color: "#1a684a"
    }
  }
  
  n1: {
    style: {
      fill: "#fff"
      stroke: "#2d7d9a"
      stroke-width: 2
      border-radius: 4
      font-size: 27
    }
  }
  n2: {
    style: {
      fill: "#fff"
      stroke: "#7d2d9a"
      stroke-width: 2
      border-radius: 4
      font-size: 27
    }
  }
  n3: {
    style: {
      fill: "#fff"
      stroke: "#9a7d2d"
      stroke-width: 2
      border-radius: 4
      font-size: 27
    }
  }
  n4: {
    style: {
      fill: "#fff"
      stroke: "#2d9a7d"
      stroke-width: 2
      border-radius: 4
      font-size: 27
    }
  }
  
  decision: {
    shape: diamond
    style: {
      fill: "#fff8e8"
      stroke: "#7d2d9a"
      stroke-width: 2
      font-size: 27
    }
  }
}
